<div class="min-h-screen bg-gray-50 py-8" dir="rtl">
  <div class="container mx-auto px-4">
    <!-- ุงูุนููุงู ุงูุฑุฆูุณู -->
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-gray-900 mb-4">ููุชุฌุงุชูุง</h1>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        ุงูุชุดู ูุฌููุนุฉ ููุชุฌุงุชูุง ุงููููุฒุฉ ูู FakeStore API
      </p>
    </div>

    <!-- ุญุงูุฉ ุงูุชุญููู -->
    <div
      *ngIf="loading$ | async"
      class="flex flex-col items-center justify-center py-20"
    >
      <div
        class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500 mb-4"
      ></div>
      <p class="text-gray-600 text-lg">ุฌุงุฑู ุชุญููู ุงูููุชุฌุงุช...</p>
    </div>

    <!-- ุญุงูุฉ ุงูุฎุทุฃ -->
    <div *ngIf="error$ | async as error" class="max-w-2xl mx-auto mb-8">
      <div class="bg-red-50 border border-red-200 rounded-xl p-6 text-center">
        <div class="text-red-500 text-4xl mb-3">โ๏ธ</div>
        <h3 class="text-red-800 font-bold text-xl mb-2">ุญุฏุซ ุฎุทุฃ</h3>
        <p class="text-red-600">{{ error }}</p>
        <button
          (click)="reloadProducts()"
          class="mt-4 bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg transition-colors duration-200"
        >
          ุฅุนุงุฏุฉ ุงููุญุงููุฉ
        </button>
      </div>
    </div>

    <!-- ุชุนููู ุงูุจูุงูุงุช ููุชุบูุฑ ูุญูู -->
    <ng-container
      *ngIf="{
        products: products$ | async,
        loading: loading$ | async,
        error: error$ | async
      } as data"
    >
      <!-- ุดุจูุฉ ุงูููุชุฌุงุช -->
      <div
        *ngIf="
          !data.loading &&
          !data.error &&
          data.products &&
          data.products.length > 0
        "
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
      >
        <!-- ุงูููุชุฌ ุงููุฑุฏู -->
        <div
          *ngFor="let product of data.products"
          class="bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 hover:border-blue-100 group"
        >
          <!-- ุตูุฑุฉ ุงูููุชุฌ - ุชู ุชูููู ุงูุญุฌู -->
          <div class="relative overflow-hidden bg-gray-100">
            <img
              [src]="product.image"
              [alt]="product.title"
              class="w-full h-40 object-contain p-4 group-hover:scale-105 transition-transform duration-300"
            />

            <!-- ุดุงุฑุฉ ุงูุฎุตู (ุงูุชุฑุงุถูุฉ) -->
            <div
              *ngIf="hasDiscount(product)"
              class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold"
            >
              {{ getDiscountPercentage(product) }}% ุฎุตู
            </div>

            <!-- ุญุงูุฉ ููุงุฏ ุงููุฎุฒูู (ุงูุชุฑุงุถูุฉ) -->
            <div
              *ngIf="!isInStock(product)"
              class="absolute inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center"
            >
              <div class="bg-white rounded-lg px-4 py-3 text-center">
                <span class="text-2xl text-gray-500 mb-1">๐ฆ</span>
                <p class="text-gray-800 font-bold text-sm">ููุฏ ูู ุงููุฎุฒูู</p>
              </div>
            </div>

            <!-- ุงูุชูููู -->
            <div
              class="absolute bottom-2 right-2 bg-white bg-opacity-95 backdrop-blur-sm px-2 py-1 rounded-full flex items-center shadow-sm"
            >
              <span class="text-yellow-500 text-xs ml-1">โ</span>
              <span class="text-xs font-bold text-gray-800">{{
                product.rating.rate | number : '1.1-1'
              }}</span>
              <span class="text-xs text-gray-500 mr-1"
                >({{ product.rating.count }})</span
              >
            </div>
          </div>

          <!-- ูุญุชูู ุงูุจุทุงูุฉ -->
          <div class="p-4">
            <!-- ุงููุฆุฉ -->
            <div class="mb-2">
              <span
                class="text-xs font-medium text-blue-600 bg-blue-50 px-2 py-1 rounded-full"
              >
                {{ product.category }}
              </span>
            </div>

            <!-- ุงูุนููุงู ูุงูุณุนุฑ -->
            <div class="flex justify-between items-start mb-3">
              <h3
                class="font-bold text-base text-gray-900 line-clamp-2 flex-1 ml-2"
              >
                {{ product.title }}
              </h3>
              <div class="flex flex-col items-end">
                <!-- ุงูุณุนุฑ ุงูุฃุตูู ูู ุญุงูุฉ ุงูุฎุตู -->
                <span
                  *ngIf="hasDiscount(product)"
                  class="text-xs text-gray-500 line-through mb-1"
                >
                  ${{ product.price | number : '1.2-2' }}
                </span>
                <span class="text-lg font-bold text-gray-900">
                  ${{
                    hasDiscount(product)
                      ? (getDiscountedPrice(product) | number : '1.2-2')
                      : (product.price | number : '1.2-2')
                  }}
                </span>
              </div>
            </div>

            <!-- ุงููุตู -->
            <p class="text-gray-600 text-xs leading-relaxed mb-3 line-clamp-2">
              {{ product.description }}
            </p>

            <!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช -->
            <div class="space-y-2">
              <!-- ุฒุฑ ุงูุฅุถุงูุฉ ุฅูู ุงูุณูุฉ -->
              <button
                (click)="onAddToCart(product)"
                [disabled]="!isInStock(product)"
                class="w-full py-2 px-3 bg-gradient-to-l from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 disabled:from-gray-300 disabled:to-gray-400 text-white rounded-lg font-semibold transition-all duration-200 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm shadow-md hover:shadow-lg disabled:shadow-none"
              >
                <span>๐</span>
                {{ isInStock(product) ? 'ุฅุถุงูุฉ ุฅูู ุงูุณูุฉ' : 'ุบูุฑ ูุชููุฑ' }}
              </button>

              <!-- ุงูุฃุฒุฑุงุฑ ุงูุฅุถุงููุฉ -->
              <div class="flex gap-2">
                <button
                  (click)="onProductClick(product.id)"
                  class="flex-1 py-1 px-2 border border-gray-200 hover:border-blue-500 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-md font-medium text-xs transition-all duration-200 flex items-center justify-center gap-1"
                >
                  <span>๐๏ธ</span>
                  ุนุฑุถ ุณุฑูุน
                </button>
                <button
                  class="w-8 h-8 border border-gray-200 hover:border-red-300 text-gray-500 hover:text-red-500 hover:bg-red-50 rounded-md transition-all duration-200 flex items-center justify-center text-xs"
                >
                  <span>โค๏ธ</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ุญุงูุฉ ุนุฏู ูุฌูุฏ ููุชุฌุงุช -->
      <div
        *ngIf="
          !data.loading &&
          !data.error &&
          data.products &&
          data.products.length === 0
        "
        class="text-center py-20"
      >
        <div class="max-w-md mx-auto">
          <div class="text-gray-300 text-6xl mb-6">๐ฆ</div>
          <h3 class="text-2xl font-bold text-gray-700 mb-3">ูุง ุชูุฌุฏ ููุชุฌุงุช</h3>
          <p class="text-gray-500 mb-8">
            ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ููุชุฌุงุช ูู ุงูููุช ุงูุญุงูู
          </p>
          <button
            (click)="reloadProducts()"
            class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-xl font-semibold transition-colors duration-200 inline-flex items-center gap-2"
          >
            <span>๐</span>
            ุฅุนุงุฏุฉ ุงูุชุญููู
          </button>
        </div>
      </div>

      <!-- ุฅุญุตุงุฆูุงุช -->
      <div
        *ngIf="
          !data.loading &&
          !data.error &&
          data.products &&
          data.products.length > 0
        "
        class="mt-12 text-center"
      >
        <div class="bg-white rounded-2xl shadow-sm p-6 max-w-md mx-auto">
          <h4 class="font-bold text-gray-800 mb-4">ุฅุญุตุงุฆูุงุช ุงูููุชุฌุงุช</h4>
          <div class="flex justify-around">
            <div class="text-center">
              <div class="text-2xl font-bold text-blue-600">
                {{ data.products.length }}
              </div>
              <div class="text-gray-600 text-sm">ุฅุฌูุงูู ุงูููุชุฌุงุช</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-green-600">
                {{ getInStockCount(data.products) }}
              </div>
              <div class="text-gray-600 text-sm">ูุชููุฑ ุจุงููุฎุฒูู</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-orange-600">
                {{ getDiscountCount(data.products) }}
              </div>
              <div class="text-gray-600 text-sm">ุนุฑูุถ ุฎุงุตุฉ</div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>
