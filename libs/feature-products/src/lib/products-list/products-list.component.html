<div
  class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 py-8"
  dir="rtl"
>
  <div class="container mx-auto px-4">
    <!-- العنوان الرئيسي المحسن -->
    <div class="text-center mb-12">
      <div class="relative inline-block">
        <h1 class="text-5xl font-bold text-gray-900 mb-4 relative">
          <span
            class="bg-gradient-to-l from-blue-600 to-purple-600 bg-clip-text text-transparent"
          >
            منتجاتنا
          </span>
          <div
            class="absolute -bottom-2 left-0 right-0 h-1 bg-gradient-to-l from-blue-500 to-purple-500 rounded-full"
          ></div>
        </h1>
      </div>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed">
        اكتشف مجموعة منتجاتنا المميزة من
        <span class="font-semibold text-blue-600">FakeStore API</span>
        مع عروض حصرية وتجربة تسوق فريدة
      </p>
    </div>

    <!-- حالة التحميل -->
    @if (loading$ | async) {
    <div class="flex flex-col items-center justify-center py-20">
      <div class="relative">
        <div
          class="animate-spin rounded-full h-20 w-20 border-t-4 border-b-4 border-blue-500 mb-4"
        ></div>
        <div
          class="absolute inset-0 animate-ping rounded-full h-20 w-20 border-t-4 border-b-4 border-blue-300"
        ></div>
      </div>
      <p class="text-gray-600 text-lg font-medium mt-4">
        جاري تحميل المنتجات...
      </p>
      <p class="text-gray-400 text-sm mt-2">يرجى الانتظار قليلاً</p>
    </div>
    }

    <!-- حالة الخطأ -->
    @if (error$ | async; as error) {
    <div class="max-w-2xl mx-auto mb-8">
      <div
        class="bg-gradient-to-l from-red-50 to-orange-50 border border-red-200 rounded-2xl p-8 text-center shadow-lg"
      >
        <div class="text-6xl mb-4">🚨</div>
        <h3 class="text-red-800 font-bold text-2xl mb-3">عذراً، حدث خطأ</h3>
        <p class="text-red-600 text-lg mb-6 leading-relaxed">{{ error }}</p>
        <div class="flex gap-4 justify-center">
          <button
            (click)="reloadProducts()"
            class="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center gap-2"
          >
            <span>🔄</span>
            إعادة المحاولة
          </button>
          <button
            onclick="location.reload()"
            class="border border-red-500 text-red-500 hover:bg-red-50 px-8 py-3 rounded-xl font-semibold transition-all duration-300"
          >
            تحديث الصفحة
          </button>
        </div>
      </div>
    </div>
    }

    <!-- شبكة المنتجات المحسنة -->
    @if (products$ | async; as products) {
    <!-- شريط الإحصائيات العلوي -->
    @if (products.length > 0) {
    <div class="mb-8">
      <div
        class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-white/20"
      >
        <div class="flex flex-wrap justify-center gap-6">
          <div class="text-center">
            <div class="text-3xl font-bold text-blue-600">
              {{ products.length }}
            </div>
            <div class="text-gray-600 text-sm mt-1">إجمالي المنتجات</div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-green-600">
              {{ getInStockCount(products) }}
            </div>
            <div class="text-gray-600 text-sm mt-1">متوفر بالمخزون</div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-orange-600">
              {{ getDiscountCount(products) }}
            </div>
            <div class="text-gray-600 text-sm mt-1">عروض خاصة</div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-purple-600">
              {{ getAveragePrice(products) | number : '1.2-2' }}$
            </div>
            <div class="text-gray-600 text-sm mt-1">متوسط السعر</div>
          </div>
        </div>
      </div>
    </div>
    } @if (products.length > 0) {
    <div
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"
    >
      @for (product of products; track product.id; let i = $index) {
      <div
        class="bg-white rounded-3xl shadow-lg hover:shadow-2xl transition-all duration-500 overflow-hidden border border-gray-100 hover:border-blue-200 group"
        [style.animation-delay]="i * 0.1 + 's'"
      >
        <!-- صورة المنتج مع تأثيرات محسنة -->
        <div
          class="relative overflow-hidden bg-gradient-to-br from-gray-50 to-blue-50"
        >
          <img
            [src]="product.image"
            [alt]="product.title"
            class="w-full h-48 object-contain p-6 group-hover:scale-110 transition-transform duration-500"
            loading="lazy"
          />

          <!-- طبقة تأثير hover -->
          <div
            class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"
          ></div>

          <!-- شارة الخصم -->
          @if (hasDiscount(product)) {
          <div class="absolute top-4 left-4">
            <div
              class="bg-gradient-to-r from-red-500 to-pink-500 text-white px-3 py-2 rounded-full text-sm font-bold shadow-lg"
            >
              🔥 {{ getDiscountPercentage(product) }}% خصم
            </div>
          </div>
          }

          <!-- حالة المخزون -->
          <div class="absolute top-4 right-4">
            @if (isInStock(product)) {
            <div
              class="bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg flex items-center gap-1"
            >
              <span class="text-xs">✓</span>
              متوفر
            </div>
            } @else {
            <div
              class="bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg flex items-center gap-1"
            >
              <span class="text-xs">✗</span>
              نفد المخزون
            </div>
            }
          </div>

          <!-- التقييم المحسن -->
          <div
            class="absolute bottom-4 right-4 bg-white/95 backdrop-blur-sm px-3 py-2 rounded-2xl flex items-center shadow-lg"
          >
            <span class="text-yellow-500 text-sm ml-1">⭐</span>
            <span class="text-sm font-bold text-gray-800 mx-1">
              {{ product.rating.rate | number : '1.1-1' }}
            </span>
            <span
              class="text-xs text-gray-500 border-r border-gray-300 pr-2 mr-2"
            >
              ({{ product.rating.count }})
            </span>
            <span class="text-xs text-blue-600 font-medium">تقييم</span>
          </div>
        </div>

        <!-- محتوى البطاقة المحسن -->
        <div class="p-6">
          <!-- الفئة -->
          <div class="mb-3">
            <span
              class="text-xs font-semibold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-full border border-blue-100"
            >
              {{ product.category }}
            </span>
          </div>

          <!-- العنوان والسعر -->
          <div class="flex justify-between items-start mb-4">
            <h3
              class="font-bold text-lg text-gray-900 line-clamp-2 flex-1 ml-3 leading-tight group-hover:text-blue-700 transition-colors duration-300"
            >
              {{ product.title }}
            </h3>
            <div class="flex flex-col items-end shrink-0">
              @if (hasDiscount(product)) {
              <span class="text-sm text-gray-500 line-through mb-1">
                ${{ product.price | number : '1.2-2' }}
              </span>
              }
              <span
                class="text-xl font-bold text-gray-900 bg-gradient-to-l from-green-600 to-emerald-600 bg-clip-text text-transparent"
              >
                ${{
                  hasDiscount(product)
                    ? (getDiscountedPrice(product) | number : '1.2-2')
                    : (product.price | number : '1.2-2')
                }}
              </span>
            </div>
          </div>

          <!-- الوصف المحسن -->
          <p
            class="text-gray-600 text-sm leading-relaxed mb-6 line-clamp-3 min-h-[60px]"
          >
            {{ product.description }}
          </p>

          <!-- أزرار الإجراءات المحسنة -->
          <div class="space-y-3">
            <button
              (click)="onAddToCart(product); $event.stopPropagation()"
              [disabled]="!isInStock(product)"
              class="w-full py-3 px-4 bg-gradient-to-l from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 disabled:from-gray-300 disabled:to-gray-400 text-white rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 disabled:scale-100 shadow-lg hover:shadow-xl disabled:shadow-none disabled:cursor-not-allowed flex items-center justify-center gap-3 text-base group/btn"
            >
              <span
                class="group-hover/btn:scale-110 transition-transform duration-300"
                >🛒</span
              >
              {{ isInStock(product) ? 'إضافة إلى السلة' : 'غير متوفر' }}
              <span
                class="group-hover/btn:translate-x-1 transition-transform duration-300"
                >←</span
              >
            </button>

            <div class="flex gap-3">
              <button
                (click)="onProductClick(product.id); $event.stopPropagation()"
                class="flex-1 py-2.5 px-3 border-2 border-gray-200 hover:border-blue-500 text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-xl font-semibold text-sm transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-2 group/details"
              >
                <span
                  class="group-hover/details:scale-110 transition-transform duration-300"
                  >👁️</span
                >
                التفاصيل
                <span
                  class="group-hover/details:translate-x-1 transition-transform duration-300"
                  >←</span
                >
              </button>
              <button
                (click)="toggleFavorite(product); $event.stopPropagation()"
                class="w-12 h-12 border-2 border-gray-200 hover:border-red-300 text-gray-500 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all duration-300 transform hover:scale-110 flex items-center justify-center text-base"
              >
                <span [class]="isFavorite(product) ? 'text-red-500' : ''"
                  >❤️</span
                >
              </button>
            </div>
          </div>
        </div>
      </div>
      }
    </div>

    <!-- زر التحميل الإضافي -->
    <div class="text-center mt-12">
      <button
        (click)="reloadProducts()"
        class="bg-gradient-to-l from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white px-10 py-4 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl inline-flex items-center gap-3"
      >
        <span>🔄</span>
        تحديث القائمة
        <span class="text-sm opacity-80">({{ products.length }} منتج)</span>
      </button>
    </div>
    } @else {
    <!-- حالة عدم وجود منتجات محسنة -->
    <div class="text-center py-20">
      <div class="max-w-md mx-auto">
        <div class="text-gray-300 text-8xl mb-8">📦</div>
        <h3 class="text-3xl font-bold text-gray-700 mb-4">لا توجد منتجات</h3>
        <p class="text-gray-500 text-lg mb-8 leading-relaxed">
          لم نتمكن من العثور على أي منتجات في الوقت الحالي.
          <br />قد يكون هذا مؤقتاً، يرجى المحاولة لاحقاً.
        </p>
        <button
          (click)="reloadProducts()"
          class="bg-blue-500 hover:bg-blue-600 text-white px-12 py-4 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl inline-flex items-center gap-3 text-lg"
        >
          <span>🔄</span>
          إعادة التحميل
        </button>
      </div>
    </div>
    } }

    <!-- تذييل الصفحة -->
    <div class="text-center mt-16 pt-8 border-t border-gray-200">
      <p class="text-gray-500 text-sm">
        تم التطوير باستخدام
        <span class="font-semibold text-blue-600">Angular</span>
        و
        <span class="font-semibold text-green-600">FakeStore API</span>
      </p>
    </div>
  </div>
</div>
